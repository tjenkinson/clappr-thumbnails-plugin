!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("clappr")):"function"==typeof define&&define.amd?define(["clappr"],e):"object"==typeof exports?exports.ClapprThumbnailsPlugin=e(require("clappr")):t.ClapprThumbnailsPlugin=e(t.clappr)}(this,function(t){return function(t){function e(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return t[o].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),u=n(8),c=n(2),l=n(7),h=o(l),f=n(6),d=o(f),p=function(t){function e(t){i(this,e);var n=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._thumbsLoaded=!1,n._show=!1,n._hoverPosition=0,n._oldContainer=null,n._thumbs=[],n._onThumbsLoaded=new c.Promise(function(t){n._onThumbsLoadedResolve=t}),n._buildThumbsFromOptions().then(function(){n._thumbsLoaded=!0,n._onThumbsLoadedResolve(),n._init()}).catch(function(t){throw t}),n}return s(e,t),a(e,[{key:"name",get:function(){return"scrub-thumbnails"}},{key:"attributes",get:function(){return{class:this.name}}},{key:"template",get:function(){return(0,u.template)(h.default)}}],[{key:"buildSpriteConfig",value:function(t,e,n,o,i,r,s){s=s||0;for(var a=[],u=0;u<e;u++)a.push({url:t,time:s+u*r,w:n,h:o,x:u%i*n,y:Math.floor(u/i)*o});return a}}]),a(e,[{key:"bindEvents",value:function(){this.listenTo(this.core.mediaControl,u.Events.MEDIACONTROL_MOUSEMOVE_SEEKBAR,this._onMouseMove),this.listenTo(this.core.mediaControl,u.Events.MEDIACONTROL_MOUSELEAVE_SEEKBAR,this._onMouseLeave),this.listenTo(this.core.mediaControl,u.Events.MEDIACONTROL_RENDERED,this._init),this.listenTo(this.core.mediaControl,u.Events.MEDIACONTROL_CONTAINERCHANGED,this._onMediaControlContainerChanged)}},{key:"_bindContainerEvents",value:function(){this._oldContainer&&this.stopListening(this._oldContainer,u.Events.CONTAINER_TIMEUPDATE,this._renderPlugin),this._oldContainer=this.core.mediaControl.container,this.listenTo(this.core.mediaControl.container,u.Events.CONTAINER_TIMEUPDATE,this._renderPlugin)}},{key:"_onMediaControlContainerChanged",value:function(){this._bindContainerEvents()}},{key:"addThumbnail",value:function(t){var e=this,n=t.constructor===Array?t:[t];return this._onThumbsLoaded.then(function(){var t=n.map(function(t){return e._addThumbFromSrc(t).then(function(t){if(e._getOptions().backdropHeight){var n=e._thumbs.indexOf(t),o=e._buildImg(t,e._getOptions().backdropHeight);e._$backdropCarouselImgs.splice(n,0,o),1===e._$backdropCarouselImgs.length?e._$carousel.append(o):0===n?e._$backdropCarouselImgs[1].before(o):e._$backdropCarouselImgs[n-1].after(o)}})});return c.Promise.all(t).then(function(){t.length>0&&e._renderPlugin()})})}},{key:"removeThumbnail",value:function(t){var e=this,n=t.constructor===Array?t:[t];return this._onThumbsLoaded.then(function(){var t=!0,o=!1;return n.forEach(function(n){var i=e._thumbs.some(function(t,o){return t.src===n&&(e._thumbs.splice(o,1),e._getOptions().backdropHeight&&(e._$backdropCarouselImgs[o].remove(),e._$backdropCarouselImgs.splice(o,1)),!0)});i?o=!0:t=!1}),o&&e._renderPlugin(),c.Promise.resolve(t)})}},{key:"_init",value:function(){this._thumbsLoaded&&(this._$backdropCarouselImgs=[],this._createElements(),this._loadBackdrop(),this._renderPlugin())}},{key:"_getOptions",value:function(){if(!("scrubThumbnails"in this.core.options))throw"'scrubThumbnails property missing from options object.";return this.core.options.scrubThumbnails}},{key:"_appendElToMediaControl",value:function(){this.core.mediaControl.$el.find(".media-control-background").first().after(this.el)}},{key:"_onMouseMove",value:function(t){this._calculateHoverPosition(t),this._show=!0,this._renderPlugin()}},{key:"_onMouseLeave",value:function(){this._show=!1,this._renderPlugin()}},{key:"_calculateHoverPosition",value:function(t){var e=t.pageX-this.core.mediaControl.$seekBarContainer.offset().left;this._hoverPosition=Math.min(1,Math.max(e/this.core.mediaControl.$seekBarContainer.width(),0))}},{key:"_buildThumbsFromOptions",value:function(){var t=this,e=this._getOptions().thumbs,n=e.map(function(e){return t._addThumbFromSrc(e)});return c.Promise.all(n)}},{key:"_addThumbFromSrc",value:function(t){var e=this;return new c.Promise(function(e,n){var o=new Image;o.onload=function(){e(o)},o.onerror=n,o.src=t.url}).then(function(n){var o=t.time,i=null;e._thumbs.some(function(t,e){return o<t.time&&(i=e,!0)}),null===i&&(i=e._thumbs.length);var r=i<e._thumbs.length?e._thumbs[i]:null,s=i>0?e._thumbs[i-1]:null;s&&(s.duration=o-s.time);var a=r?r.time-t.time:null,u=n.width,c=n.height,l={imageW:u,imageH:c,x:t.x||0,y:t.y||0,w:t.w||u,h:t.h||c,url:t.url,time:o,duration:a,src:t};return e._thumbs.splice(i,0,l),l})}},{key:"_buildImg",value:function(t,e){var n=e/t.h,o=(0,u.$)("<img />").addClass("thumbnail-img").attr("src",t.url),i=(0,u.$)("<div />").addClass("thumbnail-container");return i.css("width",t.w*n),i.css("height",e),o.css({height:t.imageH*n,left:-1*t.x*n,top:-1*t.y*n}),i.append(o),i}},{key:"_loadBackdrop",value:function(){if(this._getOptions().backdropHeight)for(var t=this._$carousel,e=0;e<this._thumbs.length;e++){var n=this._buildImg(this._thumbs[e],this._getOptions().backdropHeight);this._$backdropCarouselImgs.push(n),t.append(n)}}},{key:"_updateCarousel",value:function(){if(this._getOptions().backdropHeight){var t=this._hoverPosition,e=this.core.mediaControl.container.getDuration(),n=this.core.mediaControl.container.getStartTimeOffset(),o=n+e*t,i=this._$backdrop.width(),r=this._$carousel,s=r.width(),a=this._thumbs,u=s/a.length,c=this._getThumbIndexForTime(o),l=a[c],h=l.duration;null===h&&(h=Math.max(e+n-l.time,0));var f=o-l.time,d=f/h,p=u*d,m=c*u+p,b=m-t*i;r.css("left",-b);for(var g=this._getOptions().backdropMaxOpacity||.6,_=this._getOptions().backdropMinOpacity||.08,v=0;v<a.length;v++){var y=u*v,T=y-m;T<0&&(T=Math.min(0,T+u));var w=Math.max(g-Math.abs(T)/(2*u),_);this._$backdropCarouselImgs[v].css("opacity",w)}}}},{key:"_updateSpotlightThumb",value:function(){if(this._getOptions().spotlightHeight){var t=this._hoverPosition,e=this.core.mediaControl.container.getDuration(),n=this.core.mediaControl.container.getStartTimeOffset(),o=n+e*t,i=this._getThumbIndexForTime(o),r=this._thumbs[i],s=this._$spotlight;s.empty(),s.append(this._buildImg(r,this._getOptions().spotlightHeight));var a=this.$el.width(),u=s.width(),c=a*t-u/2;c=Math.max(Math.min(c,a-u),0),s.css("left",c)}}},{key:"_getThumbIndexForTime",value:function(t){for(var e=this._thumbs,n=e.length-1;n>=0;n--){var o=e[n];if(o.time<=t)return n}return 0}},{key:"_renderPlugin",value:function(){this._thumbsLoaded&&(this._show&&this._thumbs.length>0?(this.$el.removeClass("hidden"),this._updateCarousel(),this._updateSpotlightThumb()):this.$el.addClass("hidden"))}},{key:"_createElements",value:function(){this.$el.html(this.template({backdropHeight:this._getOptions().backdropHeight,spotlightHeight:this._getOptions().spotlightHeight})),this.$el.append(u.Styler.getStyleFor(d.default)),this._$spotlight=this.$el.find(".spotlight"),this._$backdrop=this.$el.find(".backdrop"),this._$carousel=this._$backdrop.find(".carousel"),this.$el.addClass("hidden"),this._appendElToMediaControl()}}]),e}(u.UICorePlugin);e.default=p,t.exports=e.default},function(t,e){"use strict";t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var n=this[e];n[2]?t.push("@media "+n[2]+"{"+n[1]+"}"):t.push(n[1])}return t.join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var o={},i=0;i<this.length;i++){var r=this[i][0];"number"==typeof r&&(o[r]=!0)}for(i=0;i<e.length;i++){var s=e[i];"number"==typeof s[0]&&o[s[0]]||(n&&!s[2]?s[2]=n:n&&(s[2]="("+s[2]+") and ("+n+")"),t.push(s))}},t}},function(t,e,n){var o;(function(i,r){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(i){function a(t){return"[object Array]"===Object.prototype.toString.call(t)}function u(){for(var t=0;t<P.length;t++)P[t][0](P[t][1]);P=[],w=!1}function c(t,e){P.push([t,e]),w||(w=!0,M(u,0))}function l(t,e){function n(t){d(e,t)}function o(t){m(e,t)}try{t(n,o)}catch(t){o(t)}}function h(t){var e=t.owner,n=e.state_,o=e.data_,i=t[n],r=t.then;if("function"==typeof i){n=E;try{o=i(o)}catch(t){m(r,t)}}f(r,o)||(n===E&&d(r,o),n===O&&m(r,o))}function f(t,e){var n;try{if(t===e)throw new TypeError("A promises callback cannot return that same promise.");if(e&&("function"==typeof e||"object"===("undefined"==typeof e?"undefined":s(e)))){var o=e.then;if("function"==typeof o)return o.call(e,function(o){n||(n=!0,e!==o?d(t,o):p(t,o))},function(e){n||(n=!0,m(t,e))}),!0}}catch(e){return n||m(t,e),!0}return!1}function d(t,e){t!==e&&f(t,e)||p(t,e)}function p(t,e){t.state_===k&&(t.state_=C,t.data_=e,c(g,t))}function m(t,e){t.state_===k&&(t.state_=C,t.data_=e,c(_,t))}function b(t){var e=t.then_;t.then_=void 0;for(var n=0;n<e.length;n++)h(e[n])}function g(t){t.state_=E,b(t)}function _(t){t.state_=O,b(t)}function v(t){if("function"!=typeof t)throw new TypeError("Promise constructor takes a function argument");if(this instanceof v==!1)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[],l(t,this)}var y=i.Promise,T=y&&"resolve"in y&&"reject"in y&&"all"in y&&"race"in y&&function(){var t;return new y(function(e){t=e}),"function"==typeof t}();"undefined"!=typeof e&&e?(e.Promise=T?y:v,e.Polyfill=v):(o=function(){return T?y:v}.call(e,n,e,t),!(void 0!==o&&(t.exports=o)));var w,k="pending",C="sealed",E="fulfilled",O="rejected",I=function(){},M="undefined"!=typeof r?r:setTimeout,P=[];v.prototype={constructor:v,state_:k,then_:null,data_:void 0,then:function(t,e){var n={owner:this,then:new this.constructor(I),fulfilled:t,rejected:e};return this.state_===E||this.state_===O?c(h,n):this.then_.push(n),n.then},catch:function(t){return this.then(null,t)}},v.all=function(t){var e=this;if(!a(t))throw new TypeError("You must pass an array to Promise.all().");return new e(function(e,n){function o(t){return s++,function(n){r[t]=n,--s||e(r)}}for(var i,r=[],s=0,a=0;a<t.length;a++)i=t[a],i&&"function"==typeof i.then?i.then(o(a),n):r[a]=i;s||e(r)})},v.race=function(t){var e=this;if(!a(t))throw new TypeError("You must pass an array to Promise.race().");return new e(function(e,n){for(var o,i=0;i<t.length;i++)o=t[i],o&&"function"==typeof o.then?o.then(e,n):e(o)})},v.resolve=function(t){var e=this;return t&&"object"===("undefined"==typeof t?"undefined":s(t))&&t.constructor===e?t:new e(function(e){e(t)})},v.reject=function(t){var e=this;return new e(function(e,n){n(t)})}}("undefined"!=typeof window?window:"undefined"!=typeof i?i:"undefined"!=typeof self?self:void 0)}).call(e,function(){return this}(),n(5).setImmediate)},function(t,e){"use strict";function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(t){if(l===setTimeout)return setTimeout(t,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(t,0);try{return l(t,0)}catch(e){try{return l.call(null,t,0)}catch(e){return l.call(this,t,0)}}}function r(t){if(h===clearTimeout)return clearTimeout(t);if((h===o||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function s(){m&&d&&(m=!1,d.length?p=d.concat(p):b=-1,p.length&&a())}function a(){if(!m){var t=i(s);m=!0;for(var e=p.length;e;){for(d=p,p=[];++b<e;)d&&d[b].run();b=-1,e=p.length}d=null,m=!1,r(t)}}function u(t,e){this.fun=t,this.array=e}function c(){}var l,h,f=t.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(t){l=n}try{h="function"==typeof clearTimeout?clearTimeout:o}catch(t){h=o}}();var d,p=[],m=!1,b=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];p.push(new u(t,e)),1!==p.length||m||i(a)},u.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=c,f.addListener=c,f.once=c,f.off=c,f.removeListener=c,f.removeAllListeners=c,f.emit=c,f.prependListener=c,f.prependOnceListener=c,f.listeners=function(t){return[]},f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(t,e,n){(function(t,e){"use strict";!function(t,n){function o(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var o={callback:t,args:e};return m[p]=o,d(p),p++}function i(t){delete m[t]}function r(t){var e=t.callback,o=t.args;switch(o.length){case 0:e();break;case 1:e(o[0]);break;case 2:e(o[0],o[1]);break;case 3:e(o[0],o[1],o[2]);break;default:e.apply(n,o)}}function s(t){if(b)setTimeout(s,0,t);else{var e=m[t];if(e){b=!0;try{r(e)}finally{i(t),b=!1}}}}function a(){d=function(t){e.nextTick(function(){s(t)})}}function u(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}function c(){var e="setImmediate$"+Math.random()+"$",n=function(n){n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&s(+n.data.slice(e.length))};t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),d=function(n){t.postMessage(e+n,"*")}}function l(){var t=new MessageChannel;t.port1.onmessage=function(t){var e=t.data;s(e)},d=function(e){t.port2.postMessage(e)}}function h(){var t=g.documentElement;d=function(e){var n=g.createElement("script");n.onreadystatechange=function(){s(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n)}}function f(){d=function(t){setTimeout(s,0,t)}}if(!t.setImmediate){var d,p=1,m={},b=!1,g=t.document,_=Object.getPrototypeOf&&Object.getPrototypeOf(t);_=_&&_.setTimeout?_:t,"[object process]"==={}.toString.call(t.process)?a():u()?c():t.MessageChannel?l():g&&"onreadystatechange"in g.createElement("script")?h():f(),_.setImmediate=o,_.clearImmediate=i}}("undefined"==typeof self?"undefined"==typeof t?void 0:t:self)}).call(e,function(){return this}(),n(3))},function(t,e,n){(function(t){"use strict";function o(t,e){this._id=t,this._clearFn=e}var i="undefined"!=typeof t&&t||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;e.setTimeout=function(){return new o(r.call(setTimeout,i,arguments),clearTimeout)},e.setInterval=function(){return new o(r.call(setInterval,i,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(i,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},n(4),e.setImmediate="undefined"!=typeof self&&self.setImmediate||"undefined"!=typeof t&&t.setImmediate||void 0,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||"undefined"!=typeof t&&t.clearImmediate||void 0}).call(e,function(){return this}())},function(t,e,n){e=t.exports=n(1)(),e.push([t.id,".scrub-thumbnails{position:absolute;bottom:55px;width:100%;transition:opacity .3s ease}.scrub-thumbnails.hidden{opacity:0}.scrub-thumbnails .thumbnail-container{display:inline-block;position:relative;overflow:hidden;background-color:#000}.scrub-thumbnails .thumbnail-container .thumbnail-img{position:absolute;width:auto}.scrub-thumbnails .spotlight{background-color:#000;overflow:hidden;position:absolute;bottom:0;left:0;border:2px solid #fff}.scrub-thumbnails .spotlight img{width:auto}.scrub-thumbnails .backdrop{position:absolute;left:0;bottom:0;right:0;background-color:#000;overflow:hidden}.scrub-thumbnails .backdrop .carousel{position:absolute;top:0;left:0;height:100%;white-space:nowrap}.scrub-thumbnails .backdrop .carousel img{width:auto}",""])},function(t,e){t.exports='<% if (backdropHeight) { %>\n<div class="backdrop" style="height: <%= backdropHeight%>px;">\n\t<div class="carousel"></div>\n</div>\n<% }; %>\n<% if (spotlightHeight) { %>\n<div class="spotlight" style="height: <%= spotlightHeight%>px;"></div>\n<% }; %>\n'},function(e,n){e.exports=t}])});